/*
Copyright (c) 2007-2008 the OTHER media Limited
Licensed under the BSD license, http://ojay.othermedia.org/license.html
*/
Ojay.History=(function(j){var k={'?':'--Qq--','=':'--Ee--','&':'--Aa--','_':'--Uu--','/':'--Ss--'},l=function(a){var b=decodeURIComponent(String(a));for(var c in k)b=b.replace(c,k[c]);return encodeURIComponent(b)},m=function(a){a=decodeURIComponent(String(a));for(var b in k)a=a.replace(k[b],b);return a},o=function(a){if(typeof a!='string')return a;if((/^\-?\d+(?:\.\d+)?$/.test(a)))a=Number(a);var b={'true':true,'false':false,'undefined':undefined,'null':null};for(var c in b){if(a==c)a=b[c]}return a},p=function(a){if(!a)return'';var b=[];for(var c in a)b.push(l(c)+'_'+l(a[c]));return b.join('/')},q=function(a){a=String(a).replace(/^\s*(.*?)\s*$/,'$1');if(!a)return{};var b=a.split('/'),c,d={},e;for(var i=0,n=b.length;i<n;i++){c=b[i].split('_');e=o(m(c[1]));d[m(c[0])]=e}return d};return{INTERFACE:new JS.Interface(['getInitialState','changeState']),manage:function(c,d){JS.Interface.ensure(c,this.INTERFACE);var e=String(d);var f=c.changeState.functionize();var g={};c.getInitialState=c.getInitialState.wrap(function(a){g=j.getBookmarkedState(e);if(g)g=q(g);else g=a();return g});c.changeState=function(a){a=a||{};for(var b in a)g[b]=a[b];a=p(g);j.navigate(e,a)};var h=p(c.getInitialState());j.register(e,h,function(a){a=q(a);f(c,a)});j.onLoadEvent.subscribe(function(){var a=j.getCurrentState(e);a=q(a);f(c,a)})},initialize:function(a){a=a||{};var b=(a.asset||'/robots.txt').replace(/^http:\/\/[^\/]*/ig,'');var c=a.inputID||'yui-history-field';var d=a.iframeID||'yui-history-iframe';var e=Ojay(document.body),f,g;f=Ojay.HTML.input({type:'hidden',id:c});e.insert(f,'top');g=Ojay.HTML.iframe({id:d,src:b});Ojay(g).setStyle({position:'absolute',top:0,left:0,width:'1px',height:'1px',visibility:'hidden'});e.insert(g,'top');j.initialize(c,d)}}})(YAHOO.util.History);