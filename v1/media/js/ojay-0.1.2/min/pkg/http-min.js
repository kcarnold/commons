/*
Copyright (c) 2007-2008 the OTHER media Limited
Licensed under the BSD license, http://ojay.othermedia.org/license.html
*/
Ojay.HTTP={_0:function(d,e){var f=String(d).split(/\?+/).slice(1).join('').split(/\&+/);var g=f.reduce(function(a,b){var c=b.split(/\=/);if(c[0])a[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return a},{});for(var h in e)g[h]=e[h];return g},_1:function(a){var b=this._2(a||{}),c=[];for(var d in b)c.push(encodeURIComponent(d)+'='+encodeURIComponent(b[d]));return c.join('&')},_2:function(a){var b={};for(var c in a){b[c]=(typeof a[c]=='function')?a[c]():a[c]}return b},READY_STATE:{UNINITIALIZED:0,LOADING:1,LOADED:2,INTERACTIVE:3,COMPLETE:4},VERBS:'GET POST PUT DELETE HEAD'.split(/\s+/)};Ojay.HTTP.VERBS.forEach(function(e){Ojay.HTTP[e]=function(a,b,c){var d=new Ojay.HTTP.Request(e,a,b,c);d._3();return d.chain}});Ojay.HTTP.Request=JS.Class({initialize:function(a,b,c,d){this._4=a.toUpperCase();if(Ojay.HTTP.VERBS.indexOf(this._4)==-1)return;this._5=b.split(/\?+/)[0];this._6=Ojay.HTTP._0(b,c);this._7=d||{};this.chain=new JS.MethodChain()},_3:function(){var f=Ojay.HTTP._1(this._6);var g=(this._4=='POST')?this._5:this._5+(f?'?'+f:'');var h=(this._4=='POST')?f:undefined;YAHOO.util.Connect.asyncRequest(this._4,g,{scope:this,success:function(a){var b=new Ojay.HTTP.Response(a);var c=this._7.onSuccess;var d=this._7['on'+b.status];if(typeof c=='function'){try{c(b)}catch(e){}}if(typeof d=='function'){try{d(b)}catch(e){}}this.chain.fire(b)},failure:function(a){var b=new Ojay.HTTP.Response(a);var c=this._7.onFailure;var d=this._7['on'+b.status];if(typeof c=='function'){try{c(b)}catch(e){}}if(typeof d=='function'){try{d(b)}catch(e){}}}},h)}});Ojay.HTTP.Response=JS.Class({initialize:function(b){'status statusText responseText responseXML'.split(/\s+/).forEach(function(a){this[a]=b[a]},this);this.transport=b},insertInto:function(a,b){a=Ojay(a);a.insert((this.responseText||'').stripScripts(),b||'replace');return this},evalScriptTags:function(){if(this.responseText)this.responseText.evalScripts();return this}});(function(){var i=Ojay.HTTP;var j={JS:/\.js$/i,CSS:/\.css$/i,DOMAIN:/^(https?:\/\/[^\/]+)?/i,Q:/\?+/};var k='__ojay_cross_domain__';var l=function(){Ojay(document.body).insert('<iframe name="'+k+'" style="display: none;"></iframe>','top');l=function(){}};var m=function(a){switch(true){case j.JS.test(a):return'script';break;case j.CSS.test(a):return'css';break;default:return'script';break}};var n=function(a){var b=j.DOMAIN,c=window.location.href.match(b)[0],d=a.match(b)[0];return(d==''||d==c)};JS.extend(i,{GET:i.GET.wrap(function(a,b,c,d){if(n(b)||!YAHOO.util.Get)return a(b,c,d);this.load(b,c,d)}),POST:i.POST.wrap(function(a,b,c,d){if(n(b))return a(b,c,d);this.send(b,c)}),load:function(a,b,c){var d=a.split(j.Q)[0],e=m(d);YAHOO.util.Get[e](this._8(a,b),c||{})},send:function(a,b){var c=this._9(a,b,true);l();Ojay(document.body).insert(c.node,'top');c.node.submit();c.remove()},_8:function(a,b){var c=a.split(j.Q)[0],d=this._1(this._0(a,b));return c+(d?'?'+d:'')},_9:function(c,d,e){var f=c.split(j.Q)[0],g=this._0(c,d);var h={action:f,method:'POST'};if(e)h.target=k;return Ojay(Ojay.HTML.form(h,function(a){for(var b in g)a.input({type:'hidden',name:b,value:String(g[b])})})).hide()}});i.GET.redirectTo=function(a,b){window.location.href=i._8(a,b)};i.POST.redirectTo=function(a,b){var c=i._9(a,b,false).node;Ojay(document.body).insert(c,'top');c.submit()};JS.MethodChain.addMethods(i)})();